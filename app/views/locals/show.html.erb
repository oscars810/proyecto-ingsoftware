<script src="//maps.google.com/maps/api/js?key=AIzaSyBsShmfQR57ZbpPbdBYV0yUiG9NfaAE1q8"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<section class="hero is-danger">
  <div class="hero-body">
    <div class="container">
      <h1 class="title has-text-centered"> <%= @local.nombre %></h1>
      <h2 class="subtitle has-text-centered"> <%= @local.descripcion %></h2>
      <h2 class="subtitle has-text-centered"> Comuna: <%= @local.commune.nombre %><h2>
      <h3 class="subtitle has-text-centered"> Puntuación: <%= @promedio %>
        <%if @cantidad_valoraciones == 1 %>
          de <%= @cantidad_valoraciones %> valoracion
        <%elsif @cantidad_valoraciones != 0%>
          de <%= @cantidad_valoraciones %> valoraciones
        <% end %></p></h3>
      <div class="buttons is-centered">
        <%= link_to 'Volver', local_index_path, class: "button is-link is-rounded"%>
        <% if user_signed_in? and current_user.id == @local.user_id%>
          <%= link_to 'Editar', edit_local_path(@local.id), class: "button is-primary is-rounded"%>
        <% end%>
      </div>
    </div>
  </div>
</section>
<section class="section">
<div class="columns">
  <div class="column"></div>
  <div class="column is-two-thirds">
    <div class="box">
    <h1 class="title has-text-centered"> Menus ofrecidos </h1>
      <div class="media-content">
        <div class="content">
          <table class="table">
            <thead>
              <tr>
                <th>Menú</th>
                <th>Descripción</th>
                <th>Precio</th>
              </tr>
            </thead> 
            <tbody>
              <% @menus.each do |menu| %>
                <tr>
                  <td><%= menu.nombre %></td>
                  <td><%= menu.descripcion%></td>
                  <td>$<%= menu.precio%></td>
                </tr>
              <% end %>
            </tbody> 
          </table> 

        </div>
      </div>
    </div>
  </div>
  <div class="column"></div>
</div>
</section>

<section class="section">
  <div class="notification is-fluid is-danger">
    <h1 class="title has-text-centered"> Comentarios </h1>
    <div class="buttons is-centered">
      <% if user_signed_in? and current_user.id != @local.user_id %>
        <%=link_to "Nuevo Comentario", new_local_comentario_path(@local.id), class: "button is-primary is-rounded"%>
      <% end %>
    </div>
  </div>
  <div class="columns">
    <div class="column"></div>
    <div class="column is-two-thirds">
      <% @comentarios.each do |comentario|%>
      <div class="box">
        <article class="media">
          <div class="media-left">
            <figure class="image is-64x64">
              <img class="is-rounded" src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
            </figure>
          </div>
          <div class="media-content">
            <div class="content">
              <p>
                <strong><%= comentario.user.nombre %></strong> 
                <small><i><%= comentario.created_at.strftime("%d-%m-%Y")%></i> a las <i><%= comentario.created_at.strftime("%H:%M")%></i></small>
                <br>
                <%= comentario.contenido %>
              </p>
            </div>
            <div class="buttons">
            <% if user_signed_in? and current_user.id == comentario.user_id%>
              <%= link_to 'Eliminar Comentario', local_comentario_path(@local.id, comentario.id), method: :delete, class: "button is-danger"%>
            <% end %>
            </div>
          </div>
        </article>
      </div>
      <% end %>
    </div>
    <div class="column"></div>
  </div>
</section>


<div style="width:800px; margin:0 auto;">
  <div style='width: 800px;'>
    <div id="map" style="width: 800px; height: 400px;"></div>
  </div>
  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": 20,
          "lng": 20,
          "picture": {
            "url": "http://people.mozilla.com/~faaborg/files/shiretoko/firefoxIcon/firefox-32.png",
            "width":  32,
            "height": 32
          },
          "infowindow": "hello!"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  </script>
  </div>
</div>
<br>